function createCategoryAccordion(e,t,r){var a=document.createElement("div");return a.classList.add("accordion","accordion-category"),a.setAttribute("role","tablist"),Object.keys(e).forEach(((o,c)=>{var n=createCategoryAccordionItem(o,Array.from(e[o]),t,c,r);a.appendChild(n)})),a}function createCategoryAccordionItem(e,t,r,a,o){var c=`accordion-category-${a}`,n=document.createElement("div");n.id=c,n.classList.add("accordion-item","accordion-category-item");var d=document.createElement("h2");d.classList.add("accordion-header"),d.setAttribute("role","tab");var i=document.createElement("button");i.classList.add("accordion-button"),i.setAttribute("type","button"),i.setAttribute("data-bs-toggle","collapse"),i.setAttribute("data-bs-target",`#${c} .accordion-category-collapse`),i.setAttribute("aria-expanded","false"),i.setAttribute("aria-controls",`${c} .accordion-category-collapse`),i.innerText=`${e} (${t.length})`;var s=getBackgroundColor(e);i.style.backgroundColor=s,d.appendChild(i);var l=document.createElement("div");l.classList.add("accordion-collapse","collapse","accordion-category-collapse"),l.setAttribute("role","tabpanel");var u=document.createElement("div");u.classList.add("accordion-body");var p=createSubAccordion(t,r,a,o);return u.appendChild(p),l.appendChild(u),n.appendChild(d),n.appendChild(l),n}function createSubAccordion(e,t,r,a){var o=`sub-accordion-${r}`,c=document.createElement("div");c.id=o,c.classList.add("accordion","accordion-sub"),c.setAttribute("role","tablist");var n={};return e.forEach(((e,r)=>{var d=document.createElement("div");d.classList.add("accordion-item");var i=document.createElement("h2");i.classList.add("accordion-header"),i.setAttribute("role","tab");var s=document.createElement("button");s.classList.add("accordion-button"),s.setAttribute("type","button"),s.setAttribute("data-bs-toggle","collapse"),s.setAttribute("data-bs-target",`#${o} .item-${r}`),s.setAttribute("aria-expanded","false"),s.setAttribute("aria-controls",`${o} .item-${r}`),s.innerText=e,i.appendChild(s);var l=document.createElement("div");l.classList.add("accordion-collapse","collapse","item-"+r),l.setAttribute("role","tabpanel");var u=document.createElement("div");if(u.classList.add("accordion-body"),!(e in n)){var p=document.createElement("p");p.classList.add("mb-0"),p.style.textAlign="left";var b=t.filter((t=>t.subject===e)),m=Array.from(a[e]);p.innerHTML=`\n                <strong>Rating</strong>: ${b[0].risk_category}<br><br>\n                <strong>CVSS Score</strong>: ${b[0].cvss3_core}<br><br>\n                <strong>Description</strong>:<br>${b[0].description.replace(/\n/g,"<br>")}<br><br>\n                <strong>Recommended Solution</strong>:<br>${b[0].solution}<br><br>\n                <strong>Reference</strong>:<br>${makeReferenceLink(b[0].reference)}<br>\n                <strong>Targets Affected</strong>: ${m.join(", ")}<br>\n            `,u.appendChild(p),n[e]=!0}l.appendChild(u),d.appendChild(i),d.appendChild(l),c.appendChild(d)})),c}function makeReferenceLink(e){var t=e.split(/\s+/),r="";return t.forEach((e=>{isValidURL(e)?r+=`<li><a href="${e}" target="_blank">${e}</a></li>`:r+=`<li>${e}</li>`})),""!==r&&(r="<ul>"+r+"</ul>"),r}function isValidURL(e){return new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)}function getBackgroundColor(e){switch(e){case"Critical":return"rgba(112,48,160,0.7)";case"High":return"rgba(192,1,0,0.7)";case"Medium":return"rgba(255,153,50,0.7)";case"Low":return"rgba(255,204,3,0.7)";case"Informational":return"rgba(153,204,2,0.7)";default:return"rgba(0,0,0,0)"}}function createHostAccordionAccordion(e){var t=document.createElement("div");t.classList.add("accordion","accordion-host"),t.setAttribute("role","tablist");var r=document.createElement("div");r.classList.add("accordion-item");var a=document.createElement("h2");a.classList.add("accordion-header"),a.setAttribute("role","tab");var o=document.createElement("button");o.classList.add("accordion-button"),o.setAttribute("type","button"),o.setAttribute("data-bs-toggle","collapse"),o.setAttribute("data-bs-target",".accordion-host-collapse"),o.setAttribute("aria-expanded","false"),o.setAttribute("aria-controls","accordion-host-collapse"),o.innerText="Vulnerability by Hosts",a.appendChild(o),r.appendChild(a);var c=document.createElement("div");c.classList.add("accordion-collapse","collapse","accordion-host-collapse","collapsed"),c.setAttribute("role","tabpanel");var n=document.createElement("div");return n.classList.add("accordion-body"),Object.keys(e).forEach(((t,r)=>{var a=createHostAccordion(t,Array.from(e[t]),r);n.appendChild(a)})),c.appendChild(n),r.appendChild(c),t.appendChild(r),t}function createHostAccordion(e,t,r){var a=document.createElement("div");a.classList.add("accordion-item");var o=document.createElement("h2");o.classList.add("accordion-header"),o.setAttribute("role","tab");var c=document.createElement("button");c.classList.add("accordion-button"),c.setAttribute("type","button"),c.setAttribute("data-bs-toggle","collapse"),c.setAttribute("data-bs-target",`#host-accordion-${r}`),c.setAttribute("aria-expanded","false"),c.setAttribute("aria-controls",`host-accordion-${r}`),c.innerText=e,o.appendChild(c),a.appendChild(o);var n=document.createElement("div");n.classList.add("accordion-collapse","collapse"),n.setAttribute("id",`host-accordion-${r}`),n.setAttribute("role","tabpanel"),n.setAttribute("aria-labelledby",`host-${r}`);var d=document.createElement("div");d.classList.add("accordion-body","table-responsive");var i=document.createElement("table");i.classList.add("table","table-striped");var s=document.createElement("tr");return["Vulnerability","Risk Rating","CVSS Score"].forEach((e=>{var t=document.createElement("th");t.innerText=e,s.appendChild(t)})),i.appendChild(s),new Set(t).forEach((e=>{var t=document.createElement("tr");["subject","risk_category","cvss3_core"].forEach((r=>{var a=document.createElement("td");a.innerText=e[r],"risk_category"===r&&(a.style.backgroundColor=getBackgroundColor(e[r])),t.appendChild(a)})),i.appendChild(t)})),d.appendChild(i),n.appendChild(d),a.appendChild(n),a}window.onload=function(){console.log("Pathname:",window.location.pathname);var e=window.location.pathname.split("_");console.log("Split parts:",e);var t=e[2].split(".")[0];console.log("Report id:",t),fetch(`/assets/js/security_report_id_${t}.json`).then((e=>e.json())).then((e=>{console.log("JSON data:",e);var t=e.target,r=document.getElementById("target_hosts");r?r.innerText=t.join(", "):console.error("Target hosts span not found.");var a={};e.alert_report.forEach((e=>{e.subject in a||(a[e.subject]=new Set),a[e.subject].add(e.target_affected)})),e.alert_report.sort(((e,t)=>{const r={Critical:1,High:2,Medium:3,Low:4,Informational:5};return r[e.risk_category]-r[t.risk_category]}));var o={};e.alert_report.forEach((e=>{e.risk_category in o||(o[e.risk_category]=new Set),o[e.risk_category].add(e.subject)}));var c=createCategoryAccordion(o,e.alert_report,a),n=document.querySelector(".report-alerts-by-category");n?n.appendChild(c):console.error("Report alerts by category div not found.");var d={};e.alert_report.forEach((e=>{e.target_affected.split(",").forEach((t=>{t in d||(d[t]=new Set),d[t].add(JSON.stringify(e))}))})),Object.keys(d).forEach((e=>{d[e]=Array.from(d[e]).map((e=>JSON.parse(e)))}));var i=createHostAccordionAccordion(d),s=document.querySelector(".report-alerts-by-host");s?s.appendChild(i):console.error("Report alerts by host div not found.")})).catch((e=>console.error("Error:",e)))};